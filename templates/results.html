<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analysis Results - Muscle-Form Analyzer MVP</title>
  <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body data-bs-theme="dark">
  <div class="container">
    <header class="app-header">
      <h1 class="app-title">Form Analysis Results</h1>
      <p class="lead">{{ exercise_type|capitalize }} Form Assessment</p>
    </header>
    
    <div class="row mb-4">
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Overall Score</h2>
          </div>
          <div class="card-body text-center">
            <div class="gauge-container" data-score="{{ overall_score }}">
              <svg viewBox="0 0 200 200">
                <circle class="gauge-bg" cx="100" cy="100" r="85" stroke-width="15"></circle>
                <circle class="gauge-fill" cx="100" cy="100" r="85" stroke-width="15" transform="rotate(-90 100 100)"></circle>
                <text class="gauge-text" x="100" y="100">{{ overall_score }}</text>
                <text class="gauge-label" x="100" y="125">Form Score</text>
              </svg>
            </div>
            
            <div class="mt-4">
              <p class="fw-bold">{{ overall_assessment }}</p>
              <p>{{ overall_feedback }}</p>
              
              <div class="mt-3">
                <button onclick="playVoiceFeedback()" class="btn btn-secondary">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z"/>
                    <path d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z"/>
                    <path d="M8.707 11.182A4.486 4.486 0 0 0 10.025 8a4.486 4.486 0 0 0-1.318-3.182L8 5.525A3.489 3.489 0 0 1 9.025 8 3.49 3.49 0 0 1 8 10.475l.707.707zM6.717 3.55A.5.5 0 0 1 7.5 4v8a.5.5 0 0 1-.783.413l-2.5-1.5a.5.5 0 0 1-.217-.413v-4a.5.5 0 0 1 .217-.413l2.5-1.5z"/>
                  </svg>
                  Voice Feedback
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card h-100">
          <div class="card-header">
            <h2 class="card-title">Video Analysis</h2>
          </div>
          <div class="card-body">
            <div class="video-container">
              <video id="analysis-video" class="video-player" controls autoplay muted>
                <!-- Custom demo video fallback if no uploaded video available -->
                <source src="https://assets.mixkit.co/videos/preview/mixkit-exercising-in-the-gym-lifting-a-barbell-43074-large.mp4" type="video/mp4">
                Your browser does not support the video tag.
              </video>
              <canvas class="skeleton-overlay"></canvas>
            </div>
            
            <div class="d-flex align-items-center justify-content-between mb-3">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="heatmap-toggle" onchange="toggleHeatmap()">
                <label class="form-check-label" for="heatmap-toggle">Show muscle heatmap</label>
              </div>
              <button class="btn btn-sm btn-secondary" onclick="toggle3DComparison()">3D View</button>
            </div>
            
            <div class="timeline-container">
              <div class="timeline-scrubber">
                <!-- Timeline frames will be generated by JavaScript -->
                <div class="playhead" style="left: 0%"></div>
              </div>
              <p class="text-muted small mt-1">Red areas indicate problematic frames. Click to jump to that point.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="comparison-viewer" style="display: none;">
      <div class="card mb-4">
        <div class="card-header">
          <h2 class="card-title">3D Comparison View</h2>
        </div>
        <div class="card-body">
          <div class="d-flex justify-content-between mb-3">
            <span>Your Form</span>
            <span>Ideal Form</span>
          </div>
          <div style="height: 300px; background-color: rgba(0,0,0,0.2); border-radius: 0.5rem;"></div>
          <div class="mt-3">
            <label for="opacity-slider" class="form-label">Blend Models</label>
            <input type="range" class="form-range" id="opacity-slider" min="0" max="100" value="50" onchange="updateModelOpacity(this.value)">
          </div>
        </div>
      </div>
    </div>
    
    <div class="card mb-4">
      <div class="card-header">
        <h2 class="card-title">Feedback Details</h2>
      </div>
      <div class="card-body">
        <h3 class="mb-3">Issues Detected</h3>
        
        <div class="feedback-card" data-expanded="false">
          <div class="feedback-header">
            <div class="d-flex align-items-center">
              <div class="feedback-icon error">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm3.5 10.5a.5.5 0 0 1-.708.708L8 8.707l-2.793 2.793a.5.5 0 0 1-.707-.708L7.293 8 4.5 5.207a.5.5 0 0 1 .707-.708L8 7.293l2.793-2.793a.5.5 0 0 1 .708.707L8.708 8l2.793 2.793z"/>
                </svg>
              </div>
              <h4 class="feedback-title">Knee Alignment</h4>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="feedback-chevron" viewBox="0 0 16 16">
              <path d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"/>
            </svg>
          </div>
          <div class="feedback-body">
            <p>Your knees are tracking too far forward over your toes during the squat, which can put stress on your knee joints.</p>
            <p><strong>Recommendation:</strong> Keep your knees aligned with your toes and ensure they don't extend past your toes at the bottom of the squat.</p>
            <p><strong>Problem frames:</strong> 15-20, 75-80</p>
          </div>
        </div>
        
        <div class="feedback-card" data-expanded="false">
          <div class="feedback-header">
            <div class="d-flex align-items-center">
              <div class="feedback-icon warning">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                  <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/>
                </svg>
              </div>
              <h4 class="feedback-title">Hip Depth</h4>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="feedback-chevron" viewBox="0 0 16 16">
              <path d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"/>
            </svg>
          </div>
          <div class="feedback-body">
            <p>You're not reaching adequate depth in your squat. Your hips should drop lower to engage your glutes and hamstrings fully.</p>
            <p><strong>Recommendation:</strong> Work on mobility to achieve proper depth with your thighs parallel to the ground or lower.</p>
            <p><strong>Problem frames:</strong> 45-50</p>
          </div>
        </div>
        
        <div class="feedback-card" data-expanded="false">
          <div class="feedback-header">
            <div class="d-flex align-items-center">
              <div class="feedback-icon success">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                  <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>
                </svg>
              </div>
              <h4 class="feedback-title">Spine Neutrality</h4>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="feedback-chevron" viewBox="0 0 16 16">
              <path d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"/>
            </svg>
          </div>
          <div class="feedback-body">
            <p>Good job maintaining a neutral spine throughout most of the movement.</p>
            <p><strong>Recommendation:</strong> Continue focusing on keeping your chest up and back straight during the entire movement.</p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="card mb-4">
      <div class="card-header">
        <h2 class="card-title">Improvements Plan</h2>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-4 mb-4 mb-md-0">
            <div class="card h-100">
              <div class="card-header bg-dark">
                <h5 class="card-title">Short-term Fixes</h5>
              </div>
              <div class="card-body">
                <ul class="mb-0">
                  <li>Practice box squats to feel proper depth</li>
                  <li>Use a mirror to check knee alignment</li>
                  <li>Perform ankle mobility exercises</li>
                  <li>Try lighter weights to focus on form</li>
                </ul>
              </div>
            </div>
          </div>
          <div class="col-md-4 mb-4 mb-md-0">
            <div class="card h-100">
              <div class="card-header bg-dark">
                <h5 class="card-title">Recommended Exercises</h5>
              </div>
              <div class="card-body">
                <ul class="mb-0">
                  <li>Hip flexor stretches</li>
                  <li>Goblet squats</li>
                  <li>Wall sits for knee position</li>
                  <li>Bodyweight pause squats</li>
                </ul>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card h-100">
              <div class="card-header bg-dark">
                <h5 class="card-title">Progress Tracking</h5>
              </div>
              <div class="card-body">
                <p>Upload a new video in 2 weeks to track your progress. Focus on:</p>
                <ul class="mb-0">
                  <li>Knee position relative to toes</li>
                  <li>Depth of squat (hip crease below knee)</li>
                  <li>Maintaining weight in mid-foot</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="text-center mb-5">
      <a href="/" class="btn btn-primary me-2">Analyze Another Video</a>
      <button class="btn btn-secondary" onclick="window.print()">Save Report</button>
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/circle-gauge.js') }}"></script>
  <script src="{{ url_for('static', filename='js/skeleton-overlay.js') }}"></script>
  <script src="{{ url_for('static', filename='js/app.js') }}"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize skeleton overlay
      const video = document.getElementById('analysis-video');
      const canvas = document.querySelector('.skeleton-overlay');
      
      if (video && canvas) {
        // Make sure video actually loads and plays
        video.addEventListener('error', function(e) {
          console.error('Video error:', e);
        });
        
        video.addEventListener('loadeddata', function() {
          console.log('Video loaded successfully');
        });
        
        // Try to trigger play manually after a short delay
        setTimeout(() => {
          video.play().catch(e => console.error('Could not play video:', e));
        }, 1000);
        
        // Initialize the skeleton overlay
        const overlay = new SkeletonOverlay(video, canvas);
      }
    });
  </script>
</body>
</html>