アプリ開発向けプロンプト：筋トレフォーム分析モジュール要件定義（パーソナルトレーナー対抗版）
目的: ベンチプレス、デッドリフト、スクワットにおいて、ユーザーのフォームを多角的、厳格、かつ本質的に評価し、フォームエラーの「原因推測」「潜在的リスク・パフォーマンス影響」「具体的かつ行動可能な改善策」 を提供することで、パーソナルトレーナーに匹敵する、あるいはそれ以上の学習体験と成果を提供する。

1. データ入力と初期設定（ユーザープロファイルとキャリブレーション）
ユーザープロファイル:
身長、体重、性別、年齢
トレーニング経験（初心者 / 中級者 / 上級者）
主なトレーニング目標（筋肥大 / 筋力向上 / パフォーマンス向上 / 怪我予防 / 美容）
既往歴（腰痛、肩の痛み、膝の痛みなど）
設定された習熟度と目標に基づき、アプリ内の評価閾値やフィードバックの詳細度を動的に調整する。
初期姿勢キャリブレーション:
各トレーニング種目の開始前に、ユーザーに特定の基準姿勢（例：ベンチプレスでのセットアップ姿勢、デッドリフト/スクワットでの直立姿勢）を取らせ、その際の主要関節の相対位置と身体のスケール（骨の長さなど）を測定・記憶する。
このキャリブレーションデータを、以降のフォーム分析における理想フォームの基準として使用する。
2. フォーム分析のコアロジック（厳格な多角的評価）
MediaPipe Poseから取得する関節ランドマークデータ（XY座標、可視性、Z座標）を基に、以下の各評価項目をリアルタイムおよびセッション終了後に分析する。各指標には、「理想的（緑）」「要修正（黄）」「危険（赤）」 の3段階の閾値を設定し、その範囲は厳格に定義する。

2.1. 関節角度と相対位置の厳密な評価:

対象関節: 股関節、膝関節、足首、肩関節、肘関節、手首、脊柱（首、胸椎、腰椎の分離評価）、骨盤。
評価フェーズ: セットアップ、エキセントリック（下降）、ボトム、コンセントリック（挙上）、トップ。
厳格化: 各フェーズにおける主要関節の理想角度を明確に定義し、許容誤差は最小限（例: ±3度を「理想」、±3〜±8度を「要修正」、±8度以上を「危険」） に設定。
フィードバックトリガー: 許容範囲外が3フレーム以上連続した場合、または特定のクリティカルな角度に達した場合に即時フィードバック。
2.2. バーベル（または重心）軌道の精密分析:

評価軸: 2D（側面視でのX-Y軌道）および可能であれば3D（側面・前面からの複合分析）。
厳格化: 理想軌道からの最大逸脱許容範囲をX軸、Y軸それぞれ2cm以内（理想）、2cm〜5cm（要修正）、5cm以上（危険）のように厳しく設定。
評価方法: リアルタイムでの軌道描画に加え、セッション終了後に理想軌道と実軌道を重ねたグラフで表示。
バーベル検出: 可能な限り、バーベルの端点や中心を画像認識で直接検出し、その傾きやブレも評価対象とする。
2.3. 動作速度とリズム（テンポ）の精密評価:

評価フェーズ: エキセントリック、ボトムポーズ、コンセントリック、トップポーズの各継続時間。
厳格化: 各フェーズの理想時間を明確に定義し、許容誤差を±0.2秒以内（理想）、±0.2秒〜±0.5秒（要修正）、±0.5秒以上（危険）のように設定。
検出方法: 各フェーズの開始・終了を関節角度やバー位置で厳密に定義し、フレーム数から時間を算出。
フィードバック例: 「下降が早すぎます。エキセントリック動作の筋刺激が不足します。」
2.4. 安定性と対称性の多角的評価:

安定性: 各関節（肩、股関節、膝）やバーの動きのリアルタイム標準偏差を計算。
厳格化: 標準偏差が特定の閾値（例: 5ピクセル以内を理想、5〜10ピクセルを要修正、10ピクセル以上を危険）を超えた場合に警告。
対称性: 左右の関節（肩、肘、手首、股関節、膝、足首）間の相対位置や角度の差を厳密に評価。
厳格化: 左右の差が特定の閾値（例: 3度以内を理想、3〜8度を要修正、8度以上を危険）を超えた場合に警告。
2.5. 運動連鎖と重心移動の統合分析:

単一関節の評価に留まらず、複数関節間の相対的な動きのタイミングや協調性を評価。
例: スクワットでの膝と股関節の屈曲開始タイミング、デッドリフトでの肩と腰の同時挙上。
重心移動: 身体の重心（複数の主要関節の平均位置などから推定）の前後左右へのブレや、理想的な重心パスからの逸脱を評価。
フィードバック例: 「スクワットの下降時に膝が先行しすぎています。足首の可動域不足か、股関節の使い方が不十分な可能性があります。」
3. フォームエラーの「原因推測」ロジックとフィードバック強化
検出されたフォームエラーに対し、事前に定義されたルールベースまたは機械学習モデルに基づき、その根本原因を推測し、深く踏み込んだ洞察を提供する。

3.1. エラーパターン認識と原因マッピング:

複数のフォームエラーが同時に発生しているパターンを定義し、それぞれに考えられる原因（例: 柔軟性不足、特定筋群の弱さ、意識・重心の問題、初期設定の誤り）をマッピングする。
例1 (ベンチプレス): 「肘の開きすぎ」＋「肩のすくみ」＋「バーの不安定性」
推定原因: 大胸筋の関与不足、広背筋/肩甲骨安定筋群の弱さ、肩甲骨の引き寄せ・下方回旋の意識不足。
例2 (デッドリフト): 「尻の早期挙上」＋「背中の丸まり」
推定原因: ハムストリングス/臀筋の柔軟性・筋力不足、初期セットアップでの重心位置の誤り、体幹の固定不足。
例3 (スクワット): 「ニーイン」＋「足裏の浮き」＋「股関節が開きにくい」
推定原因: 股関節外旋筋群の弱さ、足首の背屈可動域不足、扁平足傾向、足裏の重心意識不足。
3.2. 影響分析とリスク警告:

検出されたフォームエラーが**「何に影響するか」（ターゲット筋への効果減少、非ターゲット筋への過剰な負荷）と「どのようなリスクがあるか」**（怪我の種類と部位、例: 椎間板ヘルニア、腱板損傷、膝蓋腱炎）を具体的に提示する。
3.3. 具体的かつ行動可能な改善策:

原因に基づいたアドバイス:
「原因推定: 〇〇筋の弱さです。改善策: 補助エクササイズとして〇〇、〇〇（例: サイドライイングレッグレイズ、ルーマニアンデッドリフトなど）を取り入れましょう。」
「原因推定: 〇〇の柔軟性不足です。改善策: 〇〇（例: ハムストリングスストレッチ、足首のモビリティドリルなど）をウォームアップやクールダウンに取り入れましょう。」
意識改革のポイント:
「スクワットでは、『地面を押し込む』意識で立ち上がりましょう。」
「ベンチプレスでは、『バーを胸で受け止める』意識で下ろしましょう。」
段階的なドリル提案: 複雑なフォームエラーに対しては、段階的に習得できるようなドリル（例: ボックススクワット、チューブを使ったニーアウト意識付けなど）を提案。
4. ユーザーインターフェースとフィードバック体験
4.1. リアルタイム・マルチモーダルフィードバック:

視覚: 理想フォーム（半透明）、ユーザーフォーム、問題点のハイライト（赤色点滅、矢印）、バー軌道の可視化、重心軌道の可視化。
音声: 「〇〇ができていません」「△△を意識してください」「あと少しです！」など、具体的で行動を促す音声ガイダンス。危険なフォームでは「STOP！」と警告音。
触覚: (対応デバイスの場合) 振動フィードバックで特定のミスを伝える。
4.2. セッションサマリーと詳細レポート:

各レップの成功/失敗（フォーム基準達成度）を明確に表示。
最も頻繁に発生したフォームエラー、最も改善されたフォームエラーのサマリー。
「今、あなたが最も取り組むべき課題」 をトップで提示し、その詳細な原因分析と改善策へのリンク。
時系列でのフォーム改善度（偏差スコアの推移など）のグラフ表示。
理想フォームとユーザーフォームをスローモーションで並べて比較再生できる機能。
4.3. 学習コンテンツとの連携:

各フィードバックメッセージから、関連するエクササイズの解説動画や、修正ドリル、ストレッチ方法の動画コンテンツへ直接リンク。
「このフォームの重要性」や「このエラーが体にもたらす影響」を解説するミニ記事へのリンク。
5. 技術的考慮事項
MediaPipe Poseの出力調整: 必要に応じて、MediaPipeの出力座標（正規化座標かピクセル座標か）を正確に把握し、アプリの描画・分析ロジックと統一された座標系に変換する。
アライメントロジックの堅牢化: ユーザーの初期姿勢キャリブレーションと、その後のリアルタイムでの理想フォームへのアライメント（平行移動、スケーリング、回転）は、Procrustes Analysisなどのより高度な手法を検討し、体格差やカメラアングルへの耐性を高める。
パフォーマンス最適化: リアルタイム処理のため、フレームレートやCPU/GPU使用率を考慮した効率的な画像処理、分析、描画ロジックの実装。
このプロンプトは、パーソナルトレーナーが提供する「なぜそうなるのか」「どうすれば改善できるのか」という本質的な価値をアプリで再現するための具体的な要件を網羅しています。これを基に、ユーザーにとって真に価値あるフォーム分析アプリの開発を進めていってください。